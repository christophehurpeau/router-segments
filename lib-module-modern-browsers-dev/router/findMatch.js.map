{"version":3,"sources":["../../src/router/findMatch.js"],"names":["Logger","RoutesType","LocaleType","RouteMatchType","RouteType","logger","parseOtherParams","wildcard","split","findMatch","path","completePath","routes","locale","namedParams","result","some","route","routePath","getPath","Error","debug","regExp","match","exec","shift","groupCount","length","group","Map","forEach","paramName","set","isSegment","restOfThePath","nestedRoutes","defaultRoute","otherParams","undefined","Object","freeze","ref"],"mappings":"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","file":"findMatch.js","sourcesContent":["import Logger from 'nightingale-logger';\nimport type { RoutesType, LocaleType, RouteMatchType } from '../types';\nimport type { RouteType } from '../routes/index';\n\nconst logger = !PRODUCTION && new Logger('router-segments:findMatch');\n\nconst parseOtherParams = (wildcard: string) => (wildcard ? wildcard.split('/') : []);\n\nconst findMatch = (\n  path: string,\n  completePath: string,\n  routes: RoutesType,\n  locale: LocaleType,\n  namedParams: ?Map<string, string>,\n): ?RouteMatchType => {\n  let result = null;\n\n  routes.some((route: RouteType) => {\n    const routePath = route.getPath(locale);\n\n    if (!PRODUCTION && !routePath) {\n      throw new Error(`Unknown localized route for locale ${locale}`);\n    }\n\n    /* istanbul ignore next */\n    if (!PRODUCTION) logger.debug(`trying ${routePath.regExp}`);\n\n    const match = routePath.regExp.exec(path);\n    if (!match) return false;\n\n    match.shift(); // remove m[0], === path;\n\n    let groupCount = match.length;\n    let group = 0;\n\n    if (routePath.namedParams.length !== 0) {\n      // set params\n      if (!namedParams) namedParams = new Map();\n\n      routePath.namedParams.forEach((paramName: string) => {\n        namedParams.set(paramName, match[group++]);\n      });\n    }\n\n    if (route.isSegment()) {\n      const restOfThePath = match[--groupCount];\n\n      if (restOfThePath) {\n        result = findMatch(\n          `/${restOfThePath}`,\n          completePath,\n          route.nestedRoutes,\n          locale,\n          namedParams,\n        );\n\n        return result !== null;\n      }\n\n      if (!route.defaultRoute) {\n        return false;\n      }\n\n      route = route.defaultRoute;\n    }\n\n    const otherParams = group + 1 !== groupCount ? undefined : parseOtherParams(match[group]);\n\n    result = Object.freeze({\n      ref: route.ref,\n      path: completePath,\n      route,\n      routePath,\n      namedParams,\n      otherParams,\n    });\n\n    return true;\n  });\n\n  return result;\n};\n\nexport default (path: string, routes: RoutesType, locale: LocaleType = 'en'): ?RouteMatchType =>\n  findMatch(path, path, routes, locale);\n"]}